<!DOCTYPE html>
<html>
<head>
  <title>Meu Perfil</title>
</head>
<body>
  <h2>Minha Conta</h2>

  <input id="name" />
  <input id="email" />

  <button onclick="update()">Atualizar</button>
  <button onclick="remove()">Deletar Conta</button>

  <script>
    const token = localStorage.getItem('token');

    async function loadUser() {
      const res = await fetch('http://localhost:3000/users/me', {
        headers: { Authorization: `Bearer ${token}` }
      });

      const user = await res.json();
      name.value = user.name;
      email.value = user.email;
    }

    async function update() {
      await fetch('http://localhost:3000/users/me', {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({
          name: name.value,
          email: email.value
        })
      });

      alert('Dados atualizados!');
    }

    async function remove() {
      await fetch('http://localhost:3000/users/me', {
        method: 'DELETE',
        headers: { Authorization: `Bearer ${token}` }
      });

      localStorage.removeItem('token');
      alert('Conta removida');
      window.location.href = 'register.html';
    }

    loadUser();
  </script>
</body>
</html>
